---
title: "å‰ç«¯æ”»é˜²å‡ ä¸ªå°æ¡ˆä¾‹"
date: 2022-09-06T12:00:00+08:00
draft: false
author: "r0fus0d & kitezzzGrim"

---

ä¿—è¯è¯´å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´,è®°å½•ä¸€äº›å¹³æ—¶æµ‹è¯•çš„æ¡ˆä¾‹ï¼Œçœçš„ä¸‹æ¬¡é‡åˆ°å†é‡æ–°æ‘¸ç´¢

{{% admonition info "info" %}}
å…³é”®ä¿¡æ¯å‡å·²æ‰“ç ,æ¼æ´å‡å·²æäº¤ç›¸å…³ src ä¿®å¤
{{% /admonition %}}

<!--more-->

---

# ç™»é™†ç‚¹1

å¸¸è§„å‰ç«¯åŠ å¯†,f12æ‰¾passwordåŠ å¯†JSä»£ç æ¥è¿›è¡Œä¸€ä¸ªçˆ†ç ´

![](../../img/js-case/10.png)

è¿™é‡Œæ˜¯passwordçš„å…³é”®ç®—æ³•ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºè¯¥keyï¼ŒçŒœæµ‹æ˜¯ç”¨äº†desåŠ å¯†

å¯»æ‰¾passwordå¤šæ–­ç‚¹ï¼Œç„¶ååœ¨ç™»å½•æ¡†è¾“å…¥å¯†ç 

![](../../img/js-case/14.png)

è¿›å…¥è°ƒè¯•çŠ¶æ€ï¼Œä¸€æ­¥æ­¥è°ƒè¯•åˆ°åŠ å¯†ç®—æ³•è¿™ä¸€æ­¥

ä¸éš¾çŒœå‡ºï¼Œsæ˜¯åŠ å¯†åçš„ç»“æœï¼Œ`object(l["a"])`æ˜¯åŠ å¯†å‡½æ•°ï¼Œe.loginform.passwordæ˜¯è¾“å…¥çš„å¯†ç ï¼Œåé¢å°±æ˜¯keyå€¼ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªjsä»£ç æµ‹è¯•ï¼Œè¾“å…¥çš„å¯†ç ä¸ºjfhack
```js
let jiami = Object(l["a"])("jfhack", "6c81d5508f6578f7a6071e70");console.log(jiami);
```

æ§åˆ¶å°è°ƒç”¨åŠ å¯†å‡½æ•°æµ‹è¯•

![](../../img/js-case/12.png)

ç”¨ cyberchef æµ‹è¯•

![](../../img/js-case/13.png)

å¯ä»¥çœ‹åˆ°åŠ å¯†æ˜¯ä¸€è‡´çš„ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥æ§åˆ¶å°ç”¨jsæ¥ç”Ÿæˆå­—å…¸

```js
let iii = 0;
let passdic = new Array();
passdic = ['123456','000000','88888']  // è¿™é‡Œå†™å­—å…¸
for (iii=0;iii<passdic.length;iii++){
    let jiami = Object(l["a"])(passdic[iii], "6c81d5508f6578f7a6071e70");
    console.log(jiami);
}
```

---

# ç™»é™†ç‚¹2

é‡åˆ°å¦å¤–ä¸€ä¸ªç³»ç»Ÿï¼Œå¯†ç ä¹ŸåŠ å¯†äº†ï¼Œä½†å¯†ç å¥½åƒåŠ å…¥äº†æ—¶é—´ç®—æ³•ä¼šä¸€ç›´å˜åŒ–ã€‚

![](../../img/js-case/15.png)

![](../../img/js-case/16.png)

å…³é”®ä»£ç æ˜¯:

```js
data.password = common.encryptPassword(data.password);
```

äºæ˜¯ç¼–å†™äº†å¦‚ä¸‹JSä»£ç 

```js
let jiami =common.encryptPassword('123');jiami
```

![](../../img/js-case/17.png)

å¯ä»¥çœ‹åˆ° å¤šæ¬¡è¾“å‡ºä¸€æ ·çš„åŸç”Ÿå¯†ç ï¼ŒåŠ å¯†åçš„å¯†ç æ˜¯ä¸€ç›´åœ¨å˜åŒ–

åé¢æœ‰æœ‹å‹æç¤ºæ€è·¯ï¼Œå¯ä»¥ç¼–å†™JSè§¦å‘å‘åŒ…ï¼Œæ— éœ€å†™ç”Ÿæˆå­—å…¸çš„JSä»£ç ï¼Œè¿™ä¸ªè¦æ ¹æ®ç›®æ ‡ç™»å½•éƒ¨åˆ†çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š

```js
const array1 = ['a', 'b', 'c'];

array1.forEach(element => {
    // console.log(element)
    e.loginForm.password = element
    e.$store.dispatch("user/login" , e.loginForm)
});
```

---

# jsrpc ç»ƒæ‰‹æ¡ˆä¾‹

çœ‹äº† https://www.svenbeast.com/post/kn2fEdp4Q/ çš„æ¡ˆä¾‹åï¼Œå‘ç° jsrpc å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ»¡è¶³æˆ‘ä»¬jsåŠ å¯†åœºæ™¯çš„ä¸€äº›éœ€æ±‚ï¼Œç„¶åä¾¿æ‰¾äº†ä¸€ä¸ªç«™è¿›è¡Œæµ‹è¯•ã€‚

å…ˆç®€å•æŠ“ä¸ªåŒ…çœ‹ä¸‹å¯†æ–‡

![](../../img/js-case/1.png)

`ec6a6536ca304edf844d1d248a4f08dc`,å» cmd5 åæŸ¥ä¸‹å°±çŸ¥é“äº†æ˜¯2æ¬¡md5

![](../../img/js-case/2.png)

è¿™ç§æƒ…å†µä¸€èˆ¬ç›´æ¥åœ¨ burp çš„ intruder æ¨¡å—ä¸­ï¼Œpayload processing è¿›è¡Œå¤„ç†å³å¯

è¿™é‡Œç”¨jsrpcæ¥ç»ƒæ‰‹ï¼Œå…ˆf12æ‰¾ç›¸å…³çš„åŠ å¯†å‡½æ•°

å°æŠ€å·§
- å…¨å±€æœç´¢ç™»é™†ç‚¹ url
- å…¨å±€æœç´¢ passwordã€encrypto è¿™ç§å…³é”®è¯

![](../../img/js-case/3.png)

![](../../img/js-case/4.png)

å…¶å®è¿™é‡Œå¯ä»¥çœ‹åˆ°,ç›®æ ‡å°±æ˜¯ç›´æ¥è°ƒç”¨çš„ https://github.com/emn178/js-md5 åº“

ä¸ç®¡ï¼Œè£…ä½œçœ‹ä¸è§ğŸ‘€ï¼Œç°åœ¨ç›®æ ‡æ˜¯é€šè¿‡jsrpcå®ç°ï¼Œåªè¦æ‰¾åˆ°åŠ å¯†å‡½æ•°å°±è¡Œ

åœ¨æ§åˆ¶å°ï¼Œå¯¹jsä¸­çš„å‡½æ•°å’Œå€¼è¿›è¡Œè¾“å‡ºï¼Œçœ‹æ˜¯å¦å¯ä»¥å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ç»“æœ

![](../../img/js-case/5.png)

å‚è€ƒé¡¹ç›®issue https://github.com/jxhczhl/JsRpc/issues/4 ä¸­çš„æ–¹æ³•å¯ä»¥å°†å±€éƒ¨å‡½æ•°æš´éœ²ç»™å…¨å±€ä½¿ç”¨ï¼Œè¿™æ ·å°±ä¸ç”¨å¡åœ¨æ–­ç‚¹ä¸­å»è°ƒç”¨å‡½æ•°äº†(ps:ä¸¾ä¸ªä¾‹,æˆ‘è¿™ä¸ªåœºæ™¯æ¯”è¾ƒç®€å•ï¼Œéƒ½ä¸éœ€è¦æ–­ç‚¹)

```
window.test = md5
test(test('1234'));
```

![](../../img/js-case/6.png)

æ­¤æ—¶æ§åˆ¶å°èƒ½æ­£å¸¸è°ƒç”¨åŠ å¯†å‡½æ•°äº†ï¼Œä¹ŸæŠŠç›®æ ‡å‡½æ•°æ”¹ä¸ºå…¨å±€å‡½æ•°äº†ï¼Œæ¥ä¸‹æ¥æ§åˆ¶å°ç›´æ¥å¤åˆ¶ jsenv.js çš„ä»£ç ,åŒæ—¶æœ¬åœ°å¯åŠ¨ jsrpc æœåŠ¡,è¿æ¥é€šä¿¡
```
var demo = new Hlclient("ws://127.0.0.1:12080/ws?group=zzz&name=hlg");
```

åœ¨æ§åˆ¶å°æ³¨å†Œjsæ–¹æ³• é€šè¿‡ä¼ é€’å‡½æ•°åè°ƒç”¨
```js
demo.regAction("testtttt", function (resolve,param) {
    console.log(param);
    var testttt123 = test(test(param));
    resolve(testttt123);
})
```

è®¿é—®è¿œç¨‹è°ƒç”¨
```
http://127.0.0.1:12080/go?group=zzz&name=hlg&action=testtttt&param='1234'
```

![](../../img/js-case/9.png)

åç»­å¯ä»¥å‚è€ƒæ–‡ç«  https://www.svenbeast.com/post/kn2fEdp4Q/ ä¸­çš„æ–¹æ¡ˆï¼Œé€šè¿‡æœ¬åœ° mitm è‡ªåŠ¨æ›¿æ¢ payload,è¿›è¡Œçˆ†ç ´

**èƒ½ä¸èƒ½åœ¨æ§åˆ¶å°ç›´æ¥è§¦å‘å‘åŒ…**

å½“ç„¶å¯ä»¥ï¼Œå°†ç›®æ ‡å‘é€è¯·æ±‚çš„éƒ¨åˆ†ä¿®æ”¹ååœ¨æ§åˆ¶å°æ‰§è¡Œå³å¯

```js
axios.post("/******/login", {name: "admin",password: test(test('1234'))})
```

![](../../img/js-case/19.png)
